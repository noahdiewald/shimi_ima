/*! Dictionary Maker - v0.1.0 - 2013-09-19
* http://ling.wisc.edu/
* Copyright (c) 2013 UW Madison Board of Regents; Licensed GNU GPLv3 */var globals={};(function e(t,n,i){function r(a,o){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!o&&c)return c(a,!0);if(s)return s(a,!0);throw Error("Cannot find module '"+a+"'")}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return r(n?n:e)},u,u.exports,e,t,n,i)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;i.length>a;a++)r(i[a]);return r})({1:[function(e,t){var n={};n.globals={},t.exports,e("./jquery-ui-input-state.js");var i=e("./click-dispatch.js").clickDispatch,r=e("./dblclick-dispatch.js").dblclickDispatch,s=e("./changes.js").changes,a=e("./keystrokes.js").keystrokes,o=e("./form.js"),c=e("./documents/documents.js"),u=e("./file_manager/fm.js"),l=e("./index_tool/ilistingui.js"),d=e("./projects/projectui.js"),f=e("./config/config.js");String.prototype.isBlank=function(){"use strict";return/^\s*$/.test(this)&&!/\S/.test(this)},String.prototype.trim=function(){"use strict";return this.replace(/^\s+/,"").replace(/\s+$/,"")},Array.prototype.trimAll=function(){"use strict";return this.map(function(e){return e.trim()}).filter(function(e){return!e.match(/^$/)})},$(function(){"use strict";$("body").click(function(e){i(e)}),$("body").dblclick(function(e){r(e)}),a(),s(),$(".notification").hide(),$("#loading").hide(),$(document).ajaxStart(function(){$("#loading").show()}).ajaxStop(function(){$("#loading").hide()}),o.initDateFields(),$("#configuration").length>0&&f.init(),$("#all-document-container").length>0&&c.init(),$("#file-upload").length>0&&u.init(),$("#all-index-container").length>0&&l.init(),$("#projects-container").length>0&&d.init()})},{"./changes.js":2,"./click-dispatch.js":3,"./config/config.js":7,"./dblclick-dispatch.js":15,"./documents/documents.js":19,"./file_manager/fm.js":27,"./form.js":29,"./index_tool/ilistingui.js":35,"./jquery-ui-input-state.js":39,"./keystrokes.js":41,"./projects/projectui.js":45}],2:[function(e,t,n){var i=e("./documents/searchui.js"),r=function(){"use strict";$(document).on("change","#document-search-exclude",function(){return i.toggleExclusion(),!0}),$(document).on("change","#document-search-invert",function(){return i.toggleInversion(),!0})};n.changes=r},{"./documents/searchui.js":23}],3:[function(e,t,n){var i=e("./sender.js"),r=e("./dispatcher.js").dispatcher,s=e("./panel-toggle.js").panelToggler,a=e("./config/doctype-tab.js"),o=e("./config/charseq-tab").charseqTab,c=e("./documents/editui.js"),u=e("./documents/viewui.js"),l=e("./documents/indexui.js"),d=e("./documents/setsui.js"),f=e("./documents/searchui.js"),p=e("./documents/worksheetui.js"),h=e("./documents/fieldsets.js"),m=e("./index_tool/ieditui.js"),v=e("./form.js"),g=e("./projects/projectui.js"),b=e("./file_manager/fm.js"),j=e("./config/config.js"),y=function(e){"use strict";var t=r({".edit-field-button":function(e){a.editField(e)},".delete-field-button":function(e){a.deleteField(e)},".add-field-button":function(e){a.addField(e)},".edit-fieldset-button":function(e){a.editFieldset(e)},".delete-fieldset-button":function(e){a.deleteFieldset(e)},".add-fieldset-button":function(e){a.addFieldset(e)},".delete-doctype-button":function(e){a.deleteDoctype(e)},".edit-doctype-button":function(e){a.editDoctype(e)},".touch-doctype-button":function(e){a.touchDoctype(e)},"#doctype-add-button":function(e){a.addDoctype(e)},".delete-charseq-button":function(e){o.del(e)},".edit-charseq-button":function(e){o.edit(e)},"#charseq-add-button":function(){o.add()},"#maintenance-upgrade-button":function(e){j.upgradeButton(e)},".add-button":function(e){h.initFieldset(e,!1,!0)},".remove-button":function(e){h.removeFieldset(e)},"#save-document-button":function(){c.save()},"#create-document-button":function(){c.create()},"#clear-document-button":function(){c.clear()},".expander":function(e){c.toggleTextarea(e)},"label span.ui-icon-help":function(e){c.showHelpDialog(e)},"#document-edit-button":function(e){u.edit(e)},"#document-delete-button":function(){u.confirmDelete()},"#document-restore-button":function(){u.confirmRestore()},"#document-view-tree > ul > li > b":function(e){u.collapseToggle(e)},".revision-link":function(e){u.fetchRevision(e)},"#search-all-fields-switch a":function(){f.allFields()},".search-field-item":function(e){f.removeField(e)},".select-results":function(e){f.toggleSelection(e)},"#save-search-results a":function(){$("#new-set-target-input").val("search"),$("#new-set-dialog").show()},"#save-set-results a":function(){$("#new-set-target-input").val("sets"),$("#new-set-dialog").show()},"#new-set-save-button":function(){i.sender("new-set-form-submit")},"#select-all-set-elements":function(e){d.toggleSelectAll(e)},".view-document-link span":function(e){var t=e[0].parentNode;l.load(t)},".view-document-link":function(e){l.load(e)},".select-worksheet-column":function(e){var t=$(e),n=t.is(":checked"),i=t.attr("data-field-field");p.columnSelection(i,n)},".select-worksheet-row":function(e){var t=$(e),n=t.is(":checked"),i=t.attr("data-row");p.rowSelection(i,n)},"#select-all-worksheet-rows":function(e){var t=$(e).is(":checked");p.selectAllRows(t)},"#toggle-handles":function(){p.showHandles()},".fieldset-handle":function(e){p.showFieldset($(e).attr("data-field-fieldset"))},".field-handle":function(e){p.showField($(e).attr("data-field-field"))},".field-header":function(e){p.hideField($(e).attr("data-field-field"))},"#new-index-button":function(){m.newCond()},".remove-condition-button":function(e){m.remCond(e)},"#delete-index-button":function(){m.del()},"#save-index-button":function(){m.save()},"#replace-button":function(){m.replace()},"#add-index-condition-button":function(){m.addCond()},"#index-index-listing a":function(e){m.init(e)},"#create-project":function(){g.add().dialog("open")},".project-delete-button":function(e){g.del(e)},"#up-dir":function(){b.upDir()},"#root-dir":function(){b.rootDir()},".dir":function(e){b.goDir(e)},".delete-file-button":function(e){b.deleteFile(e)},".edit-file-button":function(e){b.editFile(e)},".toggler":function(e){v.toggle(e)},".cancel-dialog":function(e){v.cancelDialog(e)},"#panel-toggle li":function(e){s(e)}});t(e)};n.clickDispatch=y},{"./config/charseq-tab":6,"./config/config.js":7,"./config/doctype-tab.js":10,"./dispatcher.js":16,"./documents/editui.js":20,"./documents/fieldsets.js":21,"./documents/indexui.js":22,"./documents/searchui.js":23,"./documents/setsui.js":24,"./documents/viewui.js":25,"./documents/worksheetui.js":26,"./file_manager/fm.js":27,"./form.js":29,"./index_tool/ieditui.js":32,"./panel-toggle.js":43,"./projects/projectui.js":45,"./sender.js":46}],4:[function(e,t,n){var i=e("./charseq-elems.js").charseqElems,r=e("./charseq-tab.js").charseqTab,s=e("../form.js"),a=function(e){"use strict";var t=i.get(e),n=$("#charseq-dialog").dialog({width:650,autoOpen:!1,modal:!0,buttons:{Save:function(){var n=t.getCharseqInputVals(),i="config/charseqs",a="POST",o=function(e){r.init(),$(e).dialog("close")};e&&e.rev&&(a="PUT",i="config/charseqs/"+n._id+"?rev="+n.rev),s.send(i,n,a,o,this)},Cancel:function(){$(this).dialog("close")}},close:function(){t.clear()}});return n};n.charseqDialog=a},{"../form.js":29,"./charseq-elems.js":5,"./charseq-tab.js":6}],5:[function(e,t,n){var i=e("../form.js"),r=function(){"use strict";var e={};return e.attrs=["description","characters","name","sort_ignore","locale","tailoring","vowels","consonants","ietf_tag","iso639_tag","charseq","rev"],e.get=function(t){var n={};return n.attrs=e.attrs,n.copyValues=function(e){return Object.keys(e).forEach(function(t){n[t].val(e[t])}),n},n.getCharseqInputVals=function(){var e={category:"charseq",description:n.description.val(),characters:n.parse(n.characters.val()),name:n.name.val(),sort_ignore:n.parse(n.sort_ignore.val()),locale:n.locale.val(),tailoring:n.tailoring.val(),vowels:n.parse(n.vowels.val()),consonants:n.parse(n.consonants.val()),ietf_tag:n.ietf_tag.val(),iso639_tag:n.iso639_tag.val(),_id:n.charseq.val()||void 0,rev:n.rev.val()||void 0};return e},n.parse=function(e){return e&&!e.isBlank()?JSON.parse(e):[]},n.clear=function(){return i.clear($("#charseq-dialog .input")).removeClass("ui-state-error"),n},n.attrs.forEach(function(e){n[e]=$("#charseq-"+e+"-input")}),t&&n.copyValues(t),n},e}();n.charseqElems=r},{"../form.js":29}],6:[function(e,t,n){var i=e("./charseq-dialog.js").charseqDialog,r=e("./charseq-elems.js").charseqElems,s=e("../store.js").store,a=e("../form.js"),o=function(){"use strict";var e={};return e.add=function(){return i().dialog("open"),e},e.edit=function(t){var n={},a=r.attrs;return a.forEach(function(e){n[e]=s(t).get64("charseq-"+e)}),i(n).dialog("open"),e},e.del=function(t){var n=s(t),i=n.get("charseq-charseq"),r=n.get("charseq-rev"),o="config/charseqs/"+i+"?rev="+r,c=function(){e.init()};return window.confirm("Are you sure? This is permanent.")&&a.send(o,{},"DELETE",c,this),e},e.init=function(){var t=$("#charseq-tabs"),n=$("#charseq-tabs-headings"),i="config/charseqs";return t.tabs(),$.get(i,function(e){n.empty(),n.find(".ui-tabs-panel").remove(),t.tabs("destroy"),n.html(e),t.tabs()}),e},e}();n.charseqTab=o},{"../form.js":29,"../store.js":49,"./charseq-dialog.js":4,"./charseq-elems.js":5}],7:[function(e,t,n){var i=e("./doctype-tab.js"),r=e("./charseq-tab.js").charseqTab,s=function(){"use strict";$.post("config/upgrade"),window.alert("Upgrade In Progress")},a=function(){"use strict";return i.init(),$("#main-tabs").tabs(),r.init(),$(".simple-tabs").tabs(),!0};n.upgradeButton=s,n.init=a},{"./charseq-tab.js":6,"./doctype-tab.js":10}],8:[function(e,t,n){var i=e("./doctype-elems.js").doctypeElems,r=e("./doctype-tab.js"),s=function(e,t){"use strict";var n=i.get(t);t.rev&&!t.rev.isBlank()?n.doctype.attr("disabled","disabled"):n.doctype.removeAttr("disabled");var s=$("#doctype-dialog").dialog({autoOpen:!1,modal:!0,buttons:{Save:function(){var i=n.getDoctypeInputVals(),s=function(e){r.init(),$(e).dialog("close")};!t.rev||t.rev.isBlank()?e.post(i,s,this):(i._id=e.doctype,e.put(i,s,this))},Cancel:function(){$(this).dialog("close")}},close:function(){n.clear()}});return s};n.doctypeDialog=s},{"./doctype-elems.js":9,"./doctype-tab.js":10}],9:[function(e,t,n){var i=e("../form.js"),r=function(){"use strict";var e={};return e.attrs=["description","doctype","rev"],e.get=function(t){var n={};return n.copyValues=function(e){return Object.keys(e).forEach(function(t){n[t].val(e[t])}),n},n.getDoctypeInputVals=function(){var e={category:"doctype",description:n.description.val(),_id:n.doctype.val()};return e},n.clear=function(){return i.clear($("#doctype-dialog .input")).removeClass("ui-state-error"),n},e.attrs.forEach(function(e){n[e]=$("#doctype-"+e+"-input")}),n.copyValues(t),n},e}();n.doctypeElems=r},{"../form.js":29}],10:[function(e,t,n){var i=e("./doctype-dialog.js").doctypeDialog,r=e("./doctype-elems.js").doctypeElems,s=e("./field-dialog.js").fieldDialog,a=e("./field-elems.js").fieldElems,o=e("./fieldset-dialog.js").fieldsetDialog,c=e("./fieldset-elems.js").fieldsetElems,u=e("../store.js").store,l=e("../path.js").path,d=function(e,t){"use strict";return l(e,t,"config")},f=function(e){"use strict";return e.field=!1,$.get(""+e,function(t){var n=$("#fields-"+e.fieldset);n.empty(),n.html(t)}),!0},p=function(e){"use strict";$.get(""+e,function(t){var n=$("#fieldsets-"+e.doctype);n.empty(),n.accordion(),n.accordion("destroy"),n.html(t),n.accordion({autoHeight:!1,collapsible:!0,active:!1})})},h=function(){"use strict";var e="config/doctypes";$("#doctype-tabs").tabs(),$.get(e,function(e){$("#fieldset-doctype-input"),$("#doctype-tabs-headings").empty(),$("#doctype-tabs-headings + .ui-tabs-panel").remove(),$("#doctype-tabs").tabs("destroy"),$("#doctype-tabs-headings").html(e);var t=function(e,t){var n=$(t.panel).children("div[data-fieldset-doctype]"),i=l(n,"fieldset","config");p(i)};$("#doctype-tabs").tabs({load:function(e,n){t(e,n)}})})},m=function(e){"use strict";var t=d(e,"field"),n={},i=a.attrs,r="config/charseqs?as=options";$.get(r,function(r){$("#field-charseq-input").html(r),i.forEach(function(t){n[t]=u(e).get("field-"+t)}),s(t,n).dialog("open")})},v=function(e){"use strict";var t=window.confirm("Are you sure? This is permanent.");if(t){var n=d(e,"field"),i=function(){n.field=!1,n.rev=!1,f(n)};n.del(i,this)}},g=function(e){"use strict";var t=d(e,"field"),n="config/charseqs?as=options";$.get(n,function(e){$("#field-charseq-input").html(e),s(t,{fieldset:t.fieldset,doctype:t.doctype}).dialog("open")})},b=function(e){"use strict";var t=d(e,"fieldset"),n={},i=c.attrs;i.forEach(function(t){n[t]=u(e).get("fieldset-"+t)}),o(t,n).dialog("open")},j=function(e){"use strict";var t=d(e,"fieldset"),n=function(){t.fieldset=!1,t.rev=!1,p(t)};window.confirm("Are you sure? This is permanent.")&&t.del(n,this)},y=function(e){"use strict";var t=d(e,"fieldset");o(t,{doctype:t.doctype}).dialog("open")},w=function(e){"use strict";var t=d(e,"doctype"),n={},s=r.attrs;s.forEach(function(t){n[t]=u(e).get("doctype-"+t)}),i(t,n).dialog("open")},x=function(e){"use strict";var t=u(e).get("doctype-doctype");$.post("config/doctypes/"+t+"/touch"),window.alert("Touch In Progress")},k=function(e){"use strict";var t=d(e,"doctype"),n=function(){t.doctype=!1,t.rev=!1,h()};window.confirm("Are you sure? This is permanent.")&&t.del(n,this)},S=function(e){"use strict";var t=d(e,"doctype");i(t,{}).dialog("open")};n.initFields=f,n.initFieldsets=p,n.init=h,n.editField=m,n.deleteField=v,n.addField=g,n.editFieldset=b,n.deleteFieldset=j,n.addFieldset=y,n.editDoctype=w,n.touchDoctype=x,n.deleteDoctype=k,n.addDoctype=S},{"../path.js":44,"../store.js":49,"./doctype-dialog.js":8,"./doctype-elems.js":9,"./field-dialog.js":11,"./field-elems.js":12,"./fieldset-dialog.js":13,"./fieldset-elems.js":14}],11:[function(e,t,n){var i=e("./field-elems.js").fieldElems,r=e("./doctype-tab.js"),s=function(e,t){"use strict";var n=i.get(t),s=$("#field-dialog").dialog({autoOpen:!1,modal:!0,buttons:{Save:function(){var i=n.clearDisabled().getFieldInputVals(),s=function(t){r.initFields(e),$(t).dialog("close")};!t.rev||t.rev.isBlank()?e.post(i,s,this):(i._id=e.field,e.put(i,s,this))},Cancel:function(){$(this).dialog("close")}},close:function(){n.clear()}});return s};n.fieldDialog=s},{"./doctype-tab.js":10,"./field-elems.js":12}],12:[function(e,t,n){var i=e("../form.js"),r=e("../utils.js"),s=function(){"use strict";var e={};return e.attrs=["name","label","order","description","subcategory","head","reversal","default","required","allowed","source","max","min","regex","doctype","fieldset","charseq","rev","field"],e.get=function(t){var n={};return n.attrs=e.attrs,n.notDefault=function(){return[n.charseq,n.allowed,n.source,n.min,n.max,n.regex]},n.disable=function(){return n.notDefault().forEach(function(e){e.attr("disabled","disabled")}),n},n.clearDisabled=function(){return n.notDefault().forEach(function(e){e.attr("disabled")&&e.val("")}),n},n.copyValues=function(e){return Object.keys(e).forEach(function(t){n[t].val(e[t]),n[t].is("input[type=checkbox]")&&"true"===e[t]&&n[t].prop("checked",!0)}),n},n.getFieldInputVals=function(){var e={category:"field",name:n.name.val(),label:n.label.val(),"default":n.decodeDefaults(n.subcategory.val(),n["default"].val()),head:n.head.is(":checked"),reversal:n.reversal.is(":checked"),required:n.required.is(":checked"),order:1*n.order.val(),allowed:n.allowed.val().split(",").trimAll(),source:n.decodeSource(n.subcategory.val(),n.source.val()),min:n.decodeBound(n.subcategory.val(),n.min.val()),max:n.decodeBound(n.subcategory.val(),n.max.val()),regex:n.regex.val(),description:n.description.val(),charseq:n.charseq.val(),doctype:n.doctype.val(),fieldset:n.fieldset.val(),subcategory:n.subcategory.val()};return e},n.clear=function(){return i.clear($("#field-dialog .input")).removeClass("ui-state-error"),n.disable(),n},n.decodeBound=function(e,t){return"date"===e?t:r.stringToNumber(t)},n.decodeSource=function(e,t){return"file"===e?t.split("/").trimAll():t},n.decodeDefaults=function(e,t){switch(e){case"docmultiselect":case"multiselect":return t.split(",").trimAll();case"file":return t.split("/").trimAll();default:return t}},n.displayFields=function(e){switch(e){case"select":case"multiselect":n.disable(),n.allowed.removeAttr("disabled");break;case"docselect":case"docmultiselect":case"file":n.disable(),n.source.removeAttr("disabled");break;case"text":case"textarea":n.disable(),n.charseq.removeAttr("disabled"),n.regex.removeAttr("disabled");break;case"date":case"integer":case"rational":n.disable(),n.min.removeAttr("disabled"),n.max.removeAttr("disabled");break;default:n.disable()}},n.attrs.forEach(function(e){n[e]=$("#field-"+e+"-input")}),n.copyValues(t),n.displayFields(n.subcategory.val()),n.subcategory.change(function(){n.displayFields(n.subcategory.val())}),n},e}();n.fieldElems=s},{"../form.js":29,"../utils.js":50}],13:[function(e,t,n){var i=e("./fieldset-elems.js").fieldsetElems,r=e("./doctype-tab.js"),s=function(e,t){"use strict";var n=i.get(t),s=$("#fieldset-dialog").dialog({autoOpen:!1,modal:!0,buttons:{Save:function(){var i=n.getFieldsetInputVals(),s=function(t){e.fieldset=!1,e.rev=!1,r.initFieldsets(e),$(t).dialog("close")};!t.rev||t.rev.isBlank()?e.post(i,s,this):(i._id=e.fieldset,e.put(i,s,this))},Cancel:function(){$(this).dialog("close")}},close:function(){n.clear()}});return s};n.fieldsetDialog=s},{"./doctype-tab.js":10,"./fieldset-elems.js":14}],14:[function(e,t,n){var i=e("../form.js"),r=function(){"use strict";var e={};return e.attrs=["name","label","order","description","doctype","rev","multiple","collapse","fieldset"],e.get=function(t){var n={};return n.attrs=e.attrs,n.copyValues=function(e){return Object.keys(e).forEach(function(t){n[t].val(e[t]),n[t].is("input[type=checkbox]")&&"true"===e[t]&&n[t].attr("checked",!0)}),n},n.getFieldsetInputVals=function(){var e={category:"fieldset",name:n.name.val(),label:n.label.val(),order:1*n.order.val(),description:n.description.val(),doctype:n.doctype.val(),multiple:n.multiple.is(":checked"),collapse:n.collapse.is(":checked")};return e},n.clear=function(){return i.clear($("#fieldset-dialog .input")).removeClass("ui-state-error"),n},n.attrs.forEach(function(e){n[e]=$("#fieldset-"+e+"-input")}),n.copyValues(t),n},e}();n.fieldsetElems=r},{"../form.js":29}],15:[function(e,t,n){var i=e("./dispatcher.js").dispatcher,r=e("./panel-toggle.js").panelToggler,s=e("./documents/searchui.js"),a=e("./documents/worksheetui.js"),o=function(e){"use strict";var t=i({".search-result-field-id a":function(e){s.addField($(e).parent("h5"))},".field-view b":function(e){s.addField($(e).parent("li"))},".field-container label span":function(e){s.addField($(e).parent("label").parent("div"))},"#index-index-input-label":function(){s.addIndex()},".panel > h2":function(e){r(e)},"#toggle-handles":function(){a.hideHandles()},".fieldset-handle":function(e){a.hideFieldset($(e).attr("data-field-fieldset"))},".field-handle":function(e){a.hideField($(e).attr("data-field-field"))}});t(e)};n.dblclickDispatch=o},{"./dispatcher.js":16,"./documents/searchui.js":23,"./documents/worksheetui.js":26,"./panel-toggle.js":43}],16:[function(e,t,n){var i=function(e){"use strict";var t=function(t){var n=$(t.target);Object.keys(e).forEach(function(t){if(n.is(t)){var i=e[t];i(n)}})};return t};n.dispatcher=i},{}],17:[function(e,t,n){var i=e("../pager.js").pager,r=function(){"use strict";return"changelog"},s=function(){"use strict";var e=r(),t=$("#"+r()+"-listing"),n=function(e){var t=JSON.parse(e);return t.rows.map(function(e){e.doc.changes&&(e.doc.changes=Object.keys(e.doc.changes).map(function(t){return e.doc.changes[t]}))}),t};return i({prefix:r(),url:e,format:n,target:t}).get(),!0};n.prefix=r,n.get=s},{"../pager.js":42}],18:[function(e,t,n){var i=e("./editui.js"),r=e("../sender.js"),s=function(){"use strict";return document.getElementById("edit-command-input")},a=function(){"use strict";return $("#command-dialog")},o=function(e,t){"use strict";return e.attr("data-last-active",t)},c=function(e){"use strict";return e.attr("data-last-active")},u=function(e){"use strict";var t=!0;switch(e){case"w":case"clear":i.clear();break;case"c":case"create":i.create(),t=!1;break;case"s":case"save":i.save();break;case"d":case"delete":$("#document-view").show(),"none"!==$("#document-delete-button").css("display")&&$("#document-delete-button").click();break;case"e":case"edit":$("#document-view").show(),"none"!==$("#document-edit-button").css("display")&&($("#document-edit-button").click(),t=!1);break;case"r":case"restore":$("#document-view").show(),"none"!==$("#document-restore-button").css("display")&&$("#document-restore-button").click()}if(t){var n=a(),s=c(n);$("#"+s).focus()}else r.sender("lost-focus");return r.sender("executed-command"),!0},l=function(e){"use strict";var t=s(),n=a();return t.value="",o(n,e).show(),t.focus(),!0},d=function(){"use strict";var e=s(),t=a();return o(t,"").hide(),e.value="",!0};n.execute=u,n.dialogOpen=l,n.dialogClose=d},{"../sender.js":46,"./editui.js":20}],19:[function(e,t,n){var i,r=e("./setsui.js"),s=e("./editui.js"),a=e("./viewui.js"),o=e("./indexui.js"),c=e("./changeui.js"),u=e("../sender.js"),l=e("../store.js").store,d=function(){"use strict";return $("#index-filter-form select").change(function(){o.get()}),!0},f=function(e){"use strict";return e&&a.get(e),!0},p=function(){"use strict";return $("#all-document-container")},h=function(){"use strict";return i()+"_version"},m=function(){"use strict";return i()+"_info"},v=function(){"use strict";return i()+"_labels"},g=function(e){"use strict";return sessionStorage.setItem(m(),e),u.sender("doctype-info-ready")},b=function(){"use strict";return sessionStorage.getItem(h())},j=function(){"use strict";return l(p()).d("version")},y=function(){"use strict";return b()&&b()===j()},w=function(){"use strict";return null!==sessionStorage.getItem(m())},x=function(){"use strict";return null!==sessionStorage.getItem(v())},k=function(){"use strict";return sessionStorage.setItem(h(),j()),u.sender("version-set"),!0},S=function(){"use strict";var e;return e=y()&&w()&&x()?u.sender("labels-ready"):u.sender("bad-session-state")},_=function(){"use strict";return l($("#all-document-container")).d("doctype")},C=function(){"use strict";return l($("#container")).get("project-id")},I=function(){"use strict";return sessionStorage.clear(),u.sender("session-cleared"),!0};i=function(){"use strict";return C()+"_"+_()};var E=function(){"use strict";return JSON.parse(sessionStorage.getItem(m()))},O=function(){"use strict";return $.getJSON("./",function(e){g(JSON.stringify(e))}),!0},D=function(){"use strict";var e=E(),t={};return e.fieldsets.forEach(function(e){e.fields.forEach(function(n){t[n._id]=[e.label,n.label]})}),sessionStorage.setItem(v(),JSON.stringify(t)),u.sender("labels-ready")},T=function(){"use strict";$("form").on("submit",function(){return!1}),S(),r.updateSelection(),o.iOpts(),o.get(),d(),s.init(),f($(location)[0].hash.split("#")[1]),c.get()};n.setVersion=k,n.clearSession=I,n.identifier=i,n.info=E,n.loadDoctype=O,n.makeLabels=D,n.init=T},{"../sender.js":46,"../store.js":49,"./changeui.js":17,"./editui.js":20,"./indexui.js":22,"./setsui.js":24,"./viewui.js":25}],20:[function(e,t,n){var i,r=e("../store.js").store,s=e("../form.js"),a=e("../flash.js"),o=e("./fieldsets.js"),c=e("./viewui.js"),u=e("./indexui.js"),l=function(){"use strict";return $("#save-document-button")},d=function(){"use strict";return $("#create-document-button")},f=function(){"use strict";return $("#document-edit-button")},p=function(e){"use strict";var t=JSON.parse(e.responseText),n=e.statusText,i=$("[data-field-instance="+t.instance+"]"),r=$("[href=#"+i.parents("fieldset").attr("id")+"]").parent("li");return r.addClass("ui-state-error"),i.addClass("ui-state-error"),a.error(n,t.fieldname+" "+t.message),!0},h=function(e){"use strict";var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],n=function(){return t.map(function(){return t[Math.floor(Math.random()*t.length)]}).join("")};return $("#last-added [data-field-instance]").each(function(t,i){var r=$(i).first(),s=r.attr("data-field-instance"),a=s;e&&(a=n()),r.attr("data-group-id",a),r.attr("id",a),r.attr("data-field-instance",a),r.next(".expander").attr("data-group-id",a),r.next().next(".expander").attr("data-group-id",a)}),e&&$("#last-added").removeAttr("id"),!0},m=function(){"use strict";var e="documents/edit";return $.get(e,function(e){$("#document-edit").html(e),$("#edit-tabs").tabs(),o.initFieldsets()}),!0},v=function(){"use strict";var e="input, select, textarea",t=function(){return $("#edit-tabs")},n=t().find(".ui-tabs-active a").attr("href");return $(n).find(e).first().focus(),!0},g=function(e){"use strict";return i(e),!0},b=function(){"use strict";var e=["data-document-id","data-document-rev"];return e.forEach(function(e){l().attr(e,f().attr(e))}),l().show(),i(),!0};i=function(e){"use strict";return s.initDateFields(),h(e),!0};var j=function(){"use strict";return $(".field").each(function(){var e=$(this),t=e.attr("data-field-default");t&&""!==t?e.is("select.multiselect")?e.val(t.split(",")):e.is("input.boolean")?e.attr("checked",t===!0):e.val(t):(e.val(""),e.removeAttr("checked"))}),!0},y=function(){"use strict";if(l().hasClass("oldrev")&&!window.confirm("This data is from an older version of this document. Are you sure you want to restore it?"))return!1;var e,t,n=r(l()),i=$("#edit-document-form"),s=n.d("document"),d=n.d("rev"),f="./documents/"+s+"?rev="+d,h=$("#first-index-element").attr("data-first-key"),m=$("#first-index-element").attr("data-first-id"),v={doctype:n.d("doctype"),description:n.d("description")};$("#edit-document-form .ui-state-error").removeClass("ui-state-error"),l().hide(),$.extend(v,o.fieldsetsToObject(i)),$.ajax({type:"PUT",url:f,dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify(v),complete:function(n){204===n.status||200===n.status?(t="Success",e="Your document was saved.",c.get(s),u.get(h,m),a.highlight(t,e),l().removeClass("oldrev").show()):403===n.status?(p(n),l().show()):409===n.status&&(e=JSON.parse(n.responseText),t=n.statusText,a.error(t,e.message),l().hide())}})},w=function(){"use strict";var e=r(d()),t=$("#edit-document-form"),n=$("#first-index-element").attr("data-first-key"),i=$("#first-index-element").attr("data-first-id"),s={doctype:e.d("doctype"),description:e.d("description")};$("#edit-document-form .ui-state-error").removeClass("ui-state-error"),d().hide(),$.extend(s,o.fieldsetsToObject(t));var f=$.ajax({type:"POST",dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify(s),complete:function(e){if(201===e.status){var t="Success",r="Your document was created.",s=f.getResponseHeader("Location").match(/[a-z0-9]*$/);l().hide().attr("disabled","true"),$(".fields").remove(),o.initFieldsets(),c.get(s),u.get(n,i),a.highlight(t,r),d().show()}else 403===e.status&&(p(e),d().show())}})},x=function(){"use strict";$("#edit-document-form .ui-state-error").removeClass("ui-state-error"),l().hide().attr("disabled","disabled"),$(".fields").remove(),o.initFieldsets()},k=function(e){"use strict";var t=$("#"+e.attr("data-group-id"));return e.attr("id")===t.attr("data-group-id")?(t.toggleClass("expanded"),t.next().next("span").toggleClass("expanded")):(t.toggleClass("expanded"),e.toggleClass("expanded")),!0};n.init=m,n.selectInput=v,n.afterFreshRefresh=g,n.afterEditRefresh=b,n.afterRefresh=i,n.resetFields=j,n.save=y,n.create=w,n.clear=x,n.toggleTextarea=k},{"../flash.js":28,"../form.js":29,"../store.js":49,"./fieldsets.js":21,"./indexui.js":22,"./viewui.js":25}],21:[function(e,t,n){var i,r,s,a,o,c,u=e("../path.js").path,l=e("../store.js").store,d=e("../utils.js"),f=e("./editui.js"),p=function(e){"use strict";return $("#container-"+e)},h=function(e,t){"use strict";var n=u(e,t);return n.doctype=!1,n},m=function(e,t,n){"use strict";var i=null;i=sessionStorage.getItem(e),i?t(i):$.get(e,n)},v=function(e,t){"use strict";e=e.children(".field-container").children(".field");var n={fields:[]};return e.each(function(e,r){r=$(r);var a=l(r),o=s(r),c=a.f("instance");n.fields[e]={id:a.f("field"),name:a.f("name"),label:a.f("label"),head:"true"===a.f("head"),reversal:"true"===a.f("reversal"),required:"true"===a.f("required"),min:i(a.f("subcategory"),a.f("min")),max:i(a.f("subcategory"),a.f("max")),instance:c,charseq:a.f("charseq"),regex:a.f("regex"),order:1*a.f("order"),subcategory:a.f("subcategory"),value:o},t>=0&&(n.fields[e].index=t)}),n};i=function(e,t){"use strict";return"date"===e?t:d.stringToNumber(t)};var g=function(e){"use strict";switch(e){case"true":e=!0;break;case"false":e=!1;break;default:e=null}return e},b=function(e){"use strict";return d.isBlank(e)?e="":isNaN(e)||(e=1*e),e},j=function(e){"use strict";return e=e?e.map(function(e){return r(e)}):null};r=function(e){"use strict";return window.decodeURIComponent(e.replace(/\+/g," "))},s=function(e){"use strict";var t;switch(l(e).f("subcategory")){case"boolean":t=e.is("input:checkbox:checked");break;case"openboolean":t=g(e.val());break;case"integer":case"rational":t=b(e.val());break;case"multiselect":case"docmultiselect":t=j(e.val());break;case"select":case"docselect":t=r(e.val());break;default:t=e.val()}return t};var y=function(e,t,n){"use strict";var i=h(e,"field"),r=e.children(".fields").last(),s=function(e){n&&r.attr("id","last-added"),r.prepend(e),t&&t(r),f.afterFreshRefresh(n)},a=function(e){sessionStorage.setItem(i,e),s(e)};return m(""+i,s,a),!0},w=function(e){"use strict";e=$(e);var t=l(e).fs("fieldset"),n=$("#container-"+t);h(e,"fieldset"),n.html(""),e.find(".multifield").each(function(e,t){c(n,function(e){a($(t),e)})})},x=function(e){"use strict";a($(e))};a=function(e,t){"use strict";$("#edit-document-form .ui-state-error").removeClass("ui-state-error"),$("#save-document-button").show(),e.find(".field-view").each(function(e,n){var i,r=$(n).attr("data-field-value"),s=$(n).attr("data-field-field"),a=$(n).attr("data-field-instance");r&&(i=JSON.parse(r)),t||(t=$("body")),o(t.find(".field[data-field-field="+s+"]"),i,a)})},o=function(e,t,n){"use strict";e.is("input.boolean")?e.prop("checked",t):t&&e.is("select.open-boolean")?e.val(""+t):t&&e.is("select.multiselect")?(t=t.map(function(e){return encodeURIComponent(e).replace(/[!'()]/g,window.escape).replace(/\*/g,"%2A")}),e.val(t)):t&&e.is("select.select")?(t=encodeURIComponent(t).replace(/[!'()]/g,window.escape).replace(/\*/g,"%2A"),e.val(t)):t&&(e.is("input.text")||e.is("select.file"))?e.val(decodeURIComponent(t.replace(/\+/g," "))):e.val(t),e.attr("data-field-instance",n)},c=function(e,t,n){"use strict";var i=""+h($(e),"fieldset"),r=l($(e)).fs("fieldset"),s=$("#container-"+r),a=function(e){s.append(e),y(s,t,n)},o=function(e){sessionStorage.setItem(i,e),a(e)};return m(""+i,a,o),!1};var k=function(e){"use strict";var t={fieldsets:[]};return e.find("fieldset").each(function(e,n){n=$(n);var i,r=l(n),s={id:r.fs("fieldset"),multiple:"true"===r.fs("multiple"),collapse:"true"===r.fs("collapse"),name:r.fs("name"),label:r.fs("label"),order:1*r.fs("order")};i=p(s.id).children(".fields"),s.multiple?(s.multifields=[],i.each(function(e,t){t=$(t),s.multifields[e]=v(t,e)})):$.extend(s,v(i.first())),t.fieldsets[e]=s}),t},S=function(){"use strict";return $("fieldset").each(function(e,t){var n=l($(t));"false"===n.fs("multiple")&&c(t,!1)}),!0},_=function(e){"use strict";e.parent().remove()},C=function(){"use strict";return $(".fieldset-view").each(function(e,t){"true"===l($(t)).fs("multiple")?w(t):x(t)}),f.afterEditRefresh(),!0};n.initFieldset=c,n.fieldsetsToObject=k,n.initFieldsets=S,n.removeFieldset=_,n.fillFieldsets=C},{"../path.js":44,"../store.js":49,"../utils.js":50,"./editui.js":20}],22:[function(e,t,n){var i=e("../pager.js").pager,r=e("./viewui.js"),s=e("./editui.js"),a=function(){"use strict";return"index"},o=function(){"use strict";var e="documents/"+a(),t=$("#index-"+a()+"-input").val(),n=$("#"+a()+"-listing"),r=function(e){var n=JSON.parse(e);return n.rows=n.rows.map(function(e){return e.display_key=e.key.map(function(e){return e[1]}),t&&e.value.length>0&&(e.value=e.value.split(", ")),e
}),n};return i({prefix:a(),format:r,url:e,indexId:t,target:n}).get(),!0},c=function(){"use strict";var e,t="indexes?as=options";return $.getJSON(t,function(t){e=templates["index-options"].render(t),$("#index-index-input").html(e)}),!0},u=function(e){"use strict";var t=$(e).attr("href").slice(1);return $("#document-view").html("<em>Loading...</em>"),s.clear(),r.get(t),!0};n.prefix=a,n.get=o,n.iOpts=c,n.load=u},{"../pager.js":42,"./editui.js":20,"./viewui.js":25}],23:[function(e,t,n){e("../utils.js");var i=e("../sets.js");e("./setsui.js");var r,s,a=e("./documents.js"),o=function(){"use strict";return $("#document-search-index")},c=function(){"use strict";return $("#search-index-label")},u=function(){"use strict";return $("#document-search-term")},l=function(){"use strict";return $("#document-search-field")},d=function(){"use strict";return $("#search-field-label")},f=function(){"use strict";return $("#document-search-exclude")},p=function(){"use strict";return $("#document-search-invert")},h=function(){"use strict";return $("#search-all-fields-switch")},m=function(){"use strict";return $("#search-listing")},v=function(){"use strict";return a.identifier()},g=[o,c,l,d,f,p,h],b=function(){"use strict";var e=$("#index-index-input").val();return 0===e.length?null:e},j=function(e){"use strict";return e?!0:null},y=function(){"use strict";var e=v();localStorage.setItem(e+"_searchIndex",null),localStorage.setItem(e+"_searchIndexLabel",null),localStorage.setItem(e+"_searchFields",null),localStorage.setItem(e+"_searchExclude",null),localStorage.setItem(e+"_searchInvert",null)},w=function(){"use strict";g.forEach(function(e){var t=e();switch(t.attr("type")){case"hidden":t.val("");break;case"checkbox":t.prop("checked",!1)}})},x=function(){"use strict";g.forEach(function(e){var t=e();switch(t.attr("type")){case"hidden":break;case"checkbox":t.parent("div").hide();break;default:t.hide()}})},k=function(){"use strict";var e=v(),t=JSON.parse(sessionStorage.getItem(e+"_labels"));return t},S=function(e,t){"use strict";return templates["search-field-item"].render({fieldLabel:t,field:e})},_=function(e){"use strict";var t=k(),n=JSON.stringify(e),i=d(),r=v();l().val(n),localStorage.setItem(r+"_searchFields",n);var s=e.map(function(e){return S(e,t[e].join(": "))});return i.html(s.join(" ")),!0},C=function(){"use strict";return y(),x(),w(),!0},I=function(e){"use strict";return r(e),p().parent().show(),!0},E=function(e){"use strict";var t=v();return I(e),p().prop("checked",!0),localStorage.setItem(t+"_searchInvert",!0),!0};r=function(e){"use strict";return C(),_(e),[h(),d(),f().parent()].forEach(function(e){e.show()}),!0};var O=function(e){"use strict";var t=v();return e.length>1?r(e):I(e),f().prop("checked",!0),localStorage.setItem(t+"_searchExclude",!0),!0},D=function(e,t){"use strict";var n=v();return C(),localStorage.setItem(n+"_searchIndex",e),localStorage.setItem(n+"_searchIndexLabel",t),o().val(e),c().html(t),[h(),o(),c(),p().parent()].forEach(function(e){e.show()}),!0},T=function(e,t){"use strict";var n=v();return D(e,t),p().prop("checked",!0),localStorage.setItem(n+"_searchInvert",!0),!0},F=function(){"use strict";var e=u().val(),t="documents/search?q="+window.encodeURIComponent(e),n=l().val(),i=f().is(":checked"),r=p().is(":checked"),s=o().val(),a=k();return s?t=t+"&index="+s:(n&&(t=t+"&field="+n),i&&(t+="&exclude=true")),r&&(t+="&invert=true"),m().hide(),$.get(t,function(t){m().html(t),$(".search-result-field-id").each(function(e,t){var n=a[$(t).attr("data-field-field")].join(": "),i=$(t).children("a").first();i.html(n),i.attr("data-search-label",n)}),r||$(".search-results th").each(function(t,n){var i=$.trim($(n).children("a").html()),r=RegExp("("+e+")","g"),s=i.replace(r,'<span class="highlight">$1</span>');$(n).children("a").html(s)}),m().show()}),!0},q=function(e){"use strict";var t,n,i=v(),r=localStorage.getItem(i+"_searchFields"),a=JSON.parse(r),o=$(e).attr("data-field-field");return null!==a&&(n=a.filter(function(e){return e!==o}),t=JSON.stringify(n),localStorage.setItem(i+"_searchFields",0===n.length?null:t),localStorage.setItem(i+"_searchIndex",null),s()),!0},A=function(e){"use strict";var t,n,r=v(),a=localStorage.getItem(r+"_searchFields"),o=JSON.parse(a),c=$(e).attr("data-field-field");return null===o&&(o=[]),n=i.union(o,c),t=JSON.stringify(n),localStorage.setItem(r+"_searchFields",0===n.length?null:t),localStorage.setItem(r+"_searchIndex",null),s(),!0},N=function(){"use strict";var e=b(),t=v();return e&&(localStorage.setItem(t+"_searchFields",null),localStorage.setItem(t+"_searchIndex",e),localStorage.setItem(t+"_searchIndexLabel",$("option[value="+e+"]").html()),s()),!0},J=function(){"use strict";var e=v();return localStorage.setItem(e+"_searchInvert",j(p().is(":checked"))),localStorage.setItem(e+"_searchExclude",null),s(),!0},L=function(){"use strict";var e=v();return localStorage.setItem(e+"_searchExclude",j(f().is(":checked"))),localStorage.getItem(e+"_searchInvert",null),s(),!0};s=function(){"use strict";var e,t,n=v(),i=localStorage.getItem(n+"_searchExclude"),s=localStorage.getItem(n+"_searchInvert"),a=localStorage.getItem(n+"_searchIndex"),o=localStorage.getItem(n+"_searchFields"),c=[i,s,a,o].map(function(e){return"null"===e||"false"===e||"true"===e?JSON.parse(e):e}),u=c.every(function(e){return null===e});try{u?C():c[0]===!0?(e=JSON.parse(o),O(e)):null===c[1]&&null!==c[3]?(e=JSON.parse(o),e.length>1?r(e):I(e)):null!==c[3]?(e=JSON.parse(o),e.length>1?r(e):E(e)):null===c[1]?(t=localStorage.getItem(n+"_searchIndexLabel"),D(a,t)):c[1]===!0&&(t=localStorage.getItem(n+"_searchIndexLabel"),T(a,t))}catch(l){window.console.log(l),C()}return!0};var B=function(e){"use strict";var t=$(e);return t.is(":checked")?t.next("label").next("table").addClass("selected-for-save"):t.next("label").next("table").removeClass("selected-for-save"),!0};n.allFields=C,n.singleField=I,n.singleFieldInverse=E,n.multipleFields=r,n.excludedFields=O,n.indexOnly=D,n.indexInverse=T,n.getSearch=F,n.removeField=q,n.addField=A,n.addIndex=N,n.toggleInversion=J,n.toggleExclusion=L,n.loadSearchVals=s,n.toggleSelection=B},{"../sets.js":48,"../utils.js":50,"./documents.js":19,"./setsui.js":24}],24:[function(e,t,n){var i,r,s,a,o,c,u,l=e("../sender.js"),d=e("../flash.js"),f=e("../sets.js"),p=e("../utils.js"),h=e("./documents.js"),m=function(){"use strict";return $("#document-set-a-input")},v=function(){"use strict";return $("#document-set-b-input")},g=function(){"use strict";return $("#document-worksheets-set-input")},b=function(){"use strict";return $("#document-set-operation-input")},j=function(){"use strict";return $("#set-listing")},y=function(){"use strict";return h.identifier()+"_sets"},w=function(e,t){"use strict";return e.some(function(e){return t[0]===e[0]&&t[1]===e[1]})},x=function(e){"use strict";var t=e[0],n=f.unique(e[1],w),i=[t,n];return i},k=function(e,t){"use strict";var n=u(e)[1],i=u(t)[1],r=f.union(n,i,w);return o(r),!0},S=function(e,t){"use strict";var n=u(e)[1],i=u(t)[1],r=f.intersection(n,i,w);return o(r),!0},_=function(e,t){"use strict";var n=u(e)[1],i=u(t)[1],r=f.relativeComplement(n,i,w);return o(r),!0},C=function(e,t){"use strict";var n=u(e)[1],i=u(t)[1],r=f.symmetricDifference(n,i,w);return o(r),!0};c=function(){"use strict";var e=window.sessionStorage.getItem(y()),t=[];return null!==e&&(t=JSON.parse(e)),t};var I=function(e){"use strict";var t=u(e)[1];return o(t),!0},E=function(e){"use strict";return i(e),o([]),l.sender("sets-changed"),!0};i=function(e){"use strict";var t,n=c();return t=n.filter(function(t){return t[0]!==e}),r(t),!0};var O=function(){"use strict";var e=c();return e.map(function(e){return e[0]})};r=function(e){"use strict";var t;return Array.isArray(e)?(t=e.map(function(e){return x(e)}),window.sessionStorage.setItem(y(),JSON.stringify(t))):window.sessionStorage.settem(y(),"[]"),!0};var D=function(e){"use strict";if(Array.isArray(e)&&2===e.length){var t=c(),n=e[0],i=t.filter(function(e){return e[0]!==n});r(i.concat([e]))}return!0},T=function(e){"use strict";var t=[];switch(e){case"search":t=a();break;case"sets":t=s()}return t};s=function(){"use strict";var e,t=$("input.set-element-selection:checked");return e=$.map(t,function(e){var t=$(e).parent("td").next("td").find("a").first(),n=t.first().attr("href").replace(/^#/,""),i=t.html().trim();return[[i,n]]})},a=function(){"use strict";var e,t=$("table.selected-for-save tr");return e=$.map(t,function(e){var t=$(e).find("th a").first().attr("href").replace(/^#/,""),n=$(e).find("td.search-result-context a").first().html().trim();return[[n,t]]})},o=function(e){"use strict";var t=e.length,n=e.map(function(e){return{id:e[1],context:e[0]}}),i=templates["set-listing"].render({elements:n,total:t});return j().html(i),!0};var u=function(e){"use strict";var t,n=c();return t=n.filter(function(t){return t[0]===e})[0]},F=function(){"use strict";switch(b().val()){case"view-a":I(m().val());break;case"view-b":I(v().val());break;case"remove-a":E(m().val());break;case"remove-b":E(v().val());break;case"union":k(m().val(),v().val());break;case"intersection":S(m().val(),v().val());break;case"symmetric-difference":C(m().val(),v().val());break;case"relative-complement-b-in-a":_(m().val(),v().val());break;case"relative-complement-a-in-b":_(v().val(),m().val());break;default:}return!0},q=function(){"use strict";var e=O(),t=templates["set-options"].render({names:e});return m().html(t),v().html(t),g().html(t),!0},A=function(){"use strict";var e,t,n=$("#new-set-dialog"),i=$("#new-set-input").val(),r=$("#new-set-target-input").val();return p.isBlank(i)?d.error("Input invalid:","You must supply a valid name."):(n.hide(),e=T(r),t=[i,e],D(t),$("#new-set-input").val(""),l.sender("sets-changed"),d.highlight("Success:",'Set "'+i+'" saved.')),!0},N=function(e){"use strict";return $(e).is(":checked")?$("input.set-element-selection").prop("checked",!0):$("input.set-element-selection").prop("checked",!1),!0};n.getSet=u,n.performOp=F,n.updateSelection=q,n.saveSelected=A,n.toggleSelectAll=N},{"../flash.js":28,"../sender.js":46,"../sets.js":48,"../utils.js":50,"./documents.js":19}],25:[function(e,t,n){var i=e("../store.js").store,r=e("./indexui.js"),s=e("../flash.js"),a=e("./editui.js"),o=e("./fieldsets.js"),c=function(){"use strict";return $("#document-view")},u=function(){"use strict";return $("#document-view-tree")},l=function(){"use strict";return $("#document-view-info")},d=function(e){"use strict";return Object.keys(e).reduce(function(t,n){return void 0===e[n].newValue&&(void 0===t[e[n].fieldset]&&(t[e[n].fieldset]={}),t[e[n].fieldset][n]=e[n]),t},{})},f=function(e){"use strict";var t={};return e.changes&&(t=d(e.changes)),e.fieldsets.forEach(function(n){var i=n.id;void 0!==t[i]&&(n.removal=!0,n.altered=!0);var r=function(t){var i,r={};return e.changes&&(r=e.changes),i=r[t.instance],t.json_value=JSON.stringify(t.value),void 0!==i&&(t.changed=!0,n.altered=!0,void 0===i.originalValue?(n.addition=!0,t.newfield=!0):t.originalValue=JSON.parse(i.originalValue)),"textarea"===t.subcategory?t.is_textarea=!0:t.value&&t.subcategory.match("multi")&&(t.value=t.value.join(", ")),!0};return n.multiple?n.multifields.forEach(function(e){e.fields.forEach(function(e){return r(e),!0})}):n.fields.forEach(function(e){return r(e),!0}),!0}),!0},p=function(){"use strict";return $(".timestamp").each(function(e,t){var n=new Date($(t).text()).toLocaleString();"Invalid Date"!==n&&$(t).text(n)}),!0},h=function(e,t,n){"use strict";var r,s="documents/"+e,a=c();return t?(s=s+"/"+t,a=u(),r=function(e){return templates["document-view-tree"].render(e,{"document-view-field":templates["document-view-field"]})}):r=function(e){return templates["document-view"].render(e,{"document-view-tree":templates["document-view-tree"],"document-view-field":templates["document-view-field"]})},$.getJSON(s,function(s){var o;if(f(s,t),o=r(s),a.html(o),window.location.hash=e,p(),c().fadeTo("slow",1),n&&n(),t)$("#document-view-tree").addClass("oldrev");else{var u=$("#document-restore-button"),l=$("#document-edit-button"),d=$("#document-delete-button");"true"===i(u).d("deleted")&&(l.hide(),d.hide(),u.show())}}),!0},m=function(e,t){"use strict";var n="./documents/"+e+"?rev="+t;$("#document-restore-button");var i,a,o=$("#first-index-element").attr("data-first-key"),u=$("#first-index-element").attr("data-first-id");return $.ajax({type:"DELETE",url:n,dataType:"json",contentType:"application/json",complete:function(t){200===t.status?(a="Success",i="Your document was restored.",h(e,null,function(){c().fadeTo("slow",1),r.get(o,u)}),s.highlight(a,i)):409===t.status?(i=JSON.parse(t.responseText),a=t.statusText,s.error(a,i.message)):404===t.status&&(i="Document was erased and cannot be restored.",a=t.statusText,s.error(a,i))}}),!0},v=function(e,t){"use strict";var n,a,o="./documents/"+e+"?rev="+t,u=$("#document-restore-button"),l=$("#first-index-element").attr("data-first-key"),d=$("#first-index-element").attr("data-first-id");return $.ajax({type:"DELETE",url:o,dataType:"json",contentType:"application/json",complete:function(e){if(200===e.status){a="Success",n="Your document was deleted.";var t=JSON.parse(e.responseText);i(u).put("document-rev",t.rev),$("#document-delete-button").hide(),$("#document-edit-button").hide(),u.show(),c().fadeTo("slow",.5),r.get(l,d),s.highlight(a,n)}else 409===e.status?(n=JSON.parse(e.responseText),a=e.statusText,s.error(a,n.message)):404===e.status&&(n="Document appears to have been deleted already.",a=e.statusText,s.error(a,n))}}),!0},g=function(e){"use strict";if(window.confirm("Are you sure?")){var t=i(l()),n=t.d("document"),r=t.d("rev");e(n,r)}return!0},b=function(){"use strict";return a.resetFields(),$("#document-view-tree").hasClass("oldrev")?$("#save-document-button").addClass("oldrev"):$("#save-document-button").removeClass("oldrev"),o.fillFieldsets(),!0},j=function(){"use strict";var e=i(l()),t=e.d("document"),n=e.d("rev");return g(function(){v(t,n)})},y=function(){"use strict";var e=i(l()),t=e.d("document"),n=e.d("rev");return g(function(){m(t,n)})},w=function(e){"use strict";return $(e).parent("li").toggleClass("collapsed"),!0},x=function(e){"use strict";var t=i($(e)),n=t.d("document"),r=t.d("oldrev");return $(".revision-link").removeClass("selected-revision"),$(e).addClass("selected-revision"),h(n,r),!0};n.formatTimestamps=p,n.get=h,n.restore=m,n.del=v,n.confirmIt=g,n.edit=b,n.confirmDelete=j,n.confirmRestore=y,n.collapseToggle=w,n.fetchRevision=x},{"../flash.js":28,"../store.js":49,"./editui.js":20,"./fieldsets.js":21,"./indexui.js":22}],26:[function(e,t,n){var i=e("./setsui.js"),r=e("./documents.js"),s=e("../form.js"),a=e("../flash.js"),o=function(){"use strict";return $("#document-worksheets-set-input")},c=function(){"use strict";return $("#worksheet-area")},u=function(){"use strict";return r.identifier()+"_worksheet-template"},l=function(e){"use strict";return e?($("#worksheet-table tbody tr").addClass("selected-row"),$("#worksheet-table tbody tr input").prop("checked",!0)):($("#worksheet-table tbody tr").removeClass("selected-row"),$("#worksheet-table tbody tr input:checked").prop("checked",!1)),!0},d=function(e,t){"use strict";return t?($("#"+e).addClass("selected-row"),$("#select-all-worksheet-rows").prop("checked",!1)):($("#"+e).removeClass("selected-row"),$("#select-all-worksheet-rows").prop("checked",!1)),!0},f=function(e,t){"use strict";return t?$(".field-column."+e).addClass("selected-column"):$(".field-column."+e).removeClass("selected-column"),!0},p=function(){"use strict";return $("#worksheet-table .handle-column.fieldset").show(),!0},h=function(){"use strict";return $("#worksheet-table .handle-column.fieldset").hide(),!0},m=function(e){"use strict";return $("#worksheet-table .handle-column.field."+e).show(),!0},v=function(e){"use strict";return $("#worksheet-table .handle-column.field."+e).hide(),!0},g=function(e){"use strict";return $(".field-column."+e).show(),!0},b=function(e){"use strict";return $(".field-column."+e).hide(),!0},j=function(){"use strict";var e=r.info(),t="{{=<% %>=}}\n"+templates.worksheet.render(e);return globals[u()]=Hogan.compile(t),!0},y=function(){"use strict";var e=o().val(),t="worksheets",n=function(e,t){var n=JSON.parse(t.responseText),i=globals[u()].render(n);c().html(i)};if(!e.isBlank()){var r=i.getSet(e)[1];if(250>=r.length){var l=r.map(function(e){return e[1]});s.send(t,l,"POST",n)}else a.error("Could not load worksheet","the current set size is limited to 250 items.")}return!0};n.selectAllRows=l,n.rowSelection=d,n.columnSelection=f,n.showHandles=p,n.hideHandles=h,n.showFieldset=m,n.hideFieldset=v,n.showField=g,n.hideField=b,n.buildTemplate=j,n.fillWorksheet=y},{"../flash.js":28,"../form.js":29,"./documents.js":19,"./setsui.js":24}],27:[function(e,t,n){var i,r=e("../form.js"),s=e("../flash.js"),a=function(e){"use strict";void 0===e&&(e=""),$.get("file_manager/list_dirs/"+e,function(e){$("#file-paths").html(e)})},o=function(e){"use strict";void 0===e&&(e=""),$.get("file_manager/list_files/"+e,function(e){$("#file-listing").html(e)})},c=function(e,t){"use strict";var n=$("#file-path-input");e.path?n.val(e.path.join("/")):n.val("");var a=$("#edit-path-dialog").dialog({autoOpen:!1,modal:!0,buttons:{Move:function(){var o="file_manager/"+e._id+"?rev="+e._rev,c=function(){i(t),s.highlight("Success","File Moved")};e.path=n.val().replace(/^\s*|\s*$/g,"").replace(/\/+/g,"/").replace(/^\/|\/$/g,"").split("/"),r.send(o,e,"PUT",c,a),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}});return a},u=function(){"use strict";i(),$("#file-upload-target").load(function(){var e=$("#file-upload-target").contents().find("body pre").html(),t=function(){return e&&e.length>0?JSON.parse(e):{message:!1}};t()&&t().message&&"success"!==t().status?(s.error("Error",t().message),i()):t().message&&(s.highlight("Success",t().message),i())})},l=function(e){"use strict";var t=$(e).attr("data-path");return window.sessionStorage.fmPath=t,i(t),!0},d=function(){"use strict";return window.sessionStorage.fmPath="",i(),!0},f=function(){"use strict";var e=window.sessionStorage.fmPath,t=e.split("/");return t.pop(),t=t.join("/"),window.sessionStorage.fmPath=t,i(t),!0},p=function(e){"use strict";var t=window.sessionStorage.fmPath,n=e.attr("data-file-id"),i="file_manager/"+n;return $.getJSON(i,function(e){c(e,t).dialog("open")}),!0},h=function(e){"use strict";var t=window.sessionStorage.fmPath,n=e.attr("data-file-id"),a=e.attr("data-file-rev"),o="file_manager/"+n+"?rev="+a,c=function(){i(t),s.highlight("Success","File Deleted")};return r.send(o,null,"DELETE",c,e),!0};i=function(e){"use strict";a(e),o(e)},n.init=u,n.goDir=l,n.rootDir=d,n.upDir=f,n.editFile=p,n.deleteFile=h,n.refreshListings=i},{"../flash.js":28,"../form.js":29}],28:[function(e,t,n){var i=function(e,t,n){"use strict";var i=function(){e.fadeOut()};e.find(".notification-summary").text(t+": "),e.find(".notification-message").text(n);var r=window.setTimeout(i,7e3);e.fadeIn(),e.find(".close").click(function(){window.clearTimeout(r),e.hide()})},r=function(e,t){"use strict";return i($("#notifications-main .ui-state-error"),e,t),!0},s=function(e,t){"use strict";return i($("#notifications-main .ui-state-highlight"),e,t),!0};n.error=r,n.highlight=s},{}],29:[function(e,t,n){var i,r=e("./flash.js"),s=function(e){"use strict";var t,n=$(e);return n.attr("data-target")&&(t=$("#"+n.attr("data-target")),t.toggle()),!0},a=function(e){"use strict";var t,n,r=$(e);return r.attr("data-target")&&(n="#"+r.attr("data-target"),t=$(n),t.hide(),i(void 0,t.find("form"))),!0};i=function(e,t){"use strict";return void 0===e&&(e=$(t).find("input, select, textarea")),e.each(function(e,t){var n=$(t);n.attr("data-retain")||(n.is(":checked")&&n.attr("checked",!1),n.val(""))}),e};var o=function(e,t,n,i,s){"use strict";var a;return t&&(a=JSON.stringify(t)),$.ajax({type:n,url:e,dataType:"json",context:s,contentType:"application/json",processData:!1,data:a,complete:function(e){if(e.status>=200&&300>e.status)i(this,e);else if(500===e.status)r.error("Unknown Server Error","Please report that you received this message");else if(e.status>=400){var t=JSON.parse(e.responseText),n=e.statusText;r.error(n,t.fieldname+" "+t.message)}}}),!0},c=function(e,t){"use strict";return t.append('<span class="validation-error-message">'+e+"</span>").addClass("ui-state-highlight"),setTimeout(function(){t.removeClass("ui-state-highlight",1500)},500),!0},u=function(e,t,n,i,r){"use strict";return e.val().length>i||n>e.val().length?(e.addClass("ui-state-error"),c("Length of "+t+" must be between "+n+" and "+i+".",r),!1):!0},l=function(e,t,n,i){"use strict";return t.test(e.val())?!0:(e.addClass("ui-state-error"),c(n,i),!1)},d=function(){"use strict";return $(".date").datepicker({dateFormat:"yy-mm-dd"}),!0},f=function(e,t,n){"use strict";return $.get(e,function(e){t.html(e),n&&n()}),!1};n.toggle=s,n.cancelDialog=a,n.clear=i,n.send=o,n.updateTips=c,n.checkLength=u,n.checkRegexp=l,n.initDateFields=d,n.fillOptionsFromUrl=f},{"./flash.js":28}],30:[function(){},{}],31:[function(e,t,n){e("../jquery-ui-input-state.js");var i=e("./ihelpers.js"),r=e("../form.js"),s=e("./ievents.js"),a=function(e){"use strict";var t=$("#builder-or-input"),n=$("#builder-paren-input"),a=$("#builder-negate-input"),o=$("#builder-operator-input").inputDisable(),c=$("#builder-argument-input").inputDisable(),u=$("#builder-fieldset-input").inputDisable(),l=$("#builder-field-input").inputDisable(),d=[o,u,l],f="doctypes/"+e+"/fieldsets",p="indexes/condition";$(".ui-helper-reset div").show();var h=function(e){var t=$("#index-conditions-listing tbody");return t.append(e),t.sortable(),!1};i.fOpts(f,u,function(){u.inputEnable()}),t.change(function(){t.is(":checked")?($("#builder-conditions").hide(),$("#builder-parens").hide()):($("#builder-conditions").show(),$("#builder-parens").show())}),n.change(function(){n.val()?($("#builder-or").hide(),$("#builder-conditions").hide()):($("#builder-or").show(),$("#builder-conditions").show())});var m=function(){s.setIndexFieldsetEvents(e,u,l,function(){return o.inputDisable(),l.inputDisable(),c.inputDisable(),function(){l.inputEnable()}})},v=function(){s.setIndexFieldEvents(e,u,l,function(){return o.inputDisable(),c.inputDisable(),function(){o.inputEnable()}})},g=function(){s.setIndexOperatorEvents(c,o,l,function(){return c.inputDisable(),function(){c.inputEnable()}})},b=$("#index-builder-dialog").dialog({autoOpen:!1,modal:!0,buttons:{Create:function(){$(".input").removeClass("ui-state-error");var e=!0;t.is(":checked")||n.val()||d.forEach(function(t){t.val().isBlank()?(t.addClass("ui-state-error"),e=!1):t.removeClass("ui-state-error")}),e&&(t.is(":checked")?$.get(p,{is_or:!0},function(e){h(e)}):n.val()?$.get(p,{is_or:!1,parens:n.val(),negate:!1},function(e){h(e)}):$.get(p,{is_or:!1,parens:!1,negate:a.is(":checked"),fieldset:u.val(),field:l.val(),operator:o.val(),argument:c.val()},function(e){h(e)}),$(this).dialog("close"))},Cancel:function(){$(this).dialog("close")}},close:function(){$("#builder-conditions").show(),u.unbind("change"),l.unbind("change"),o.unbind("change"),r.clear($(".input")).removeClass("ui-state-error")}});return m(),v(),g(),b};n.initIndexBuilderDialog=a},{"../form.js":29,"../jquery-ui-input-state.js":39,"./ievents.js":33,"./ihelpers.js":34}],32:[function(e,t,n){var i=e("./new-dialog.js").initIndexNewDialog,r=e("./builder-dialog.js").initIndexBuilderDialog,s=e("./replace-dialog.js").initReplaceDialog,a=e("./ilistingui.js"),o=e("./ipreviewui.js"),c=e("./ihelpers.js"),u=e("../form.js"),l=e("../flash.js"),d=function(){"use strict";return $("#index-conditions-listing tbody")},f=function(){"use strict";return $("#index-editing-data")},p=function(e,t,n){"use strict";switch(t){case"integer":case"rational":e=1*e}switch(n){case"hasExactly":case"hasGreater":case"hasLess":e=Math.floor(1*e)}return e},h=function(e,t){"use strict";var n=t.map(function(t,n){n=$(n);var i,r="true"===n.find("td.or-condition").attr("data-value"),s=n.find("td.paren-condition").attr("data-value");if(r)i={is_or:!0,parens:!1};else if(s)i={is_or:!1,parens:s};else{var a=n.find("td.field-condition").attr("data-value"),o=n.find("td.fieldset-condition").attr("data-value"),u=n.find("td.argument-condition").attr("data-value"),l=c.getFieldDoc(a,o,e),d="true"===n.find("td.negate-condition").attr("data-value"),f=n.find("td.operator-condition").attr("data-value");u=p(u,l.subcategory,f),i={is_or:!1,parens:!1,negate:d,fieldset:o,field:a,operator:f,argument:u}}return i}).toArray();return n},m=function(e,t){"use strict";var n=e.attr("data-index-id"),i=e.attr("data-index-rev"),r="indexes/"+n+"?rev="+i,s=e.attr("data-index-doctype"),a={_id:n,category:"index",doctype:s,show_deleted:"true"===e.attr("data-index-show_deleted"),fields:JSON.parse(e.attr("data-index-fields")),fields_label:JSON.parse(e.attr("data-index-fields_label")),name:e.attr("data-index-name"),conditions:h(s,$("#index-conditions-listing tbody tr"))};return e.attr("data-index-replace_function")&&(a.replace_function=e.attr("data-index-replace_function")),u.send(r,a,"PUT",t,this),!1},v=function(e,t,n,i){"use strict";var r,s,a="indexes/"+e+"?rev="+t;return $.ajax({type:"DELETE",url:a,dataType:"json",contentType:"application/json",complete:function(e){204===e.status?(r="Success",s=n,i(),l.highlight(r,s)):409===e.status?(s=JSON.parse(e.responseText),r=e.statusText,l.error(r,s.message)):404===e.status&&(s="Index appears to have been deleted already.",r=e.statusText,l.error(r,s))}}),!1},g=function(e){"use strict";var t=$(e).attr("data-index-id"),n="indexes/"+t,i=$("#index-conditions");return $.get(n,function(e){i.html(e),d().sortable(),o.get()}),!1},b=function(){"use strict";var e=f();if(0!==e.length){var t=function(){g(e),l.highlight("Success","Your index has been saved.")};m(e,t)}else l.highlight("Info","No index has been chosen to save.")},j=function(){"use strict";var e=f();return 0!==e.length?s.dialog("open"):l.highlight("Info","You must choose an index first."),!0},y=function(){"use strict";var e=f();return 0!==e.length?r(e.attr("data-index-doctype")).dialog("open"):l.highlight("Info","You must choose an index first."),!0},w=function(e){"use strict";return $(e).closest("tr").remove(),!0},x=function(){"use strict";return i().dialog("open"),!0},k=function(){"use strict";var e=f();if(0!==e.length){var t=e.attr("data-index-id"),n=e.attr("data-index-rev"),i="Your index has been deleted.",r=function(){$("#index-conditions").empty(),a.init()};window.confirm("Are you sure?")&&v(t,n,i,r)}else l.highlight("Info","No index has been chosen to delete.");return!0};n.init=g,n.save=b,n.replace=j,n.addCond=y,n.remCond=w,n.newCond=x,n.del=k},{"../flash.js":28,"../form.js":29,"./builder-dialog.js":31,"./ihelpers.js":34,"./ilistingui.js":35,"./ipreviewui.js":36,"./new-dialog.js":37,"./replace-dialog.js":38}],33:[function(e,t,n){var i=e("./ihelpers.js"),r=function(e,t,n){"use strict";return e.change(function(){var r,s="doctypes/"+e.val()+"/fieldsets";n&&(r=n()),i.fOpts(s,t,r)}),!1},s=function(e,t,n,r){"use strict";return t.change(function(){var s;if("string"!=typeof e&&(e=e.val()),t.val()){var a="doctypes/"+e+"/fieldsets/"+t.val()+"/fields?as=options";r&&(s=r()),i.fOpts(a,n,s)}}),!0},a=function(e,t,n,r){"use strict";return n.change(function(){var s,a=n.val(),o=t.val();r&&(s=r()),a.isBlank()||i.getFieldDoc(a,o,e,function(e){i.alterOpts(e,a,s)})}),!0},o=function(e,t,n,r){"use strict";return t.change(function(){var s;r&&(s=r()),i.alterArg(e,t,n,s)}),!0};n.setIndexOperatorEvents=o,n.setIndexFieldEvents=a,n.setIndexFieldsetEvents=s,n.setIndexDoctypeEvents=r},{"./ihelpers.js":34}],34:[function(e,t,n){var i=e("../sess.js"),r=function(e,t){"use strict";return e.children().show(),t.forEach(function(t){e.children("option:contains("+t+")").hide()}),!1},s=function(e){"use strict";var t=$("#builder-operator-input");switch(e.subcategory){case"select":case"docselect":case"text":case"textarea":r(t,["member","true"]);break;case"integer":case"rational":case"date":r(t,["member","true","match"]);break;case"boolean":case"openboolean":r(t,["equal","greater","less","member","match"]);break;case"multiselect":case"docmultiselect":r(t,["equal","greater","less","true","match"])}return!1},a=function(e,t,n,r){"use strict";var s=function(){return i.get(n.val())};r();try{e.removeAttr("disabled").datepicker("destroy"),e.removeAttr("disabled").autocomplete("destroy")}catch(a){window.console.log(a.message)}var o=function(e,t){return"date"===t.subcategory?(e.removeAttr("disabled"),e.datepicker({dateFormat:"yy-mm-dd"})):(e.removeAttr("disabled"),e.autocomplete({source:t.allowed})),!0},c=s();if(c)switch(t.val()){case"true":case"isDefined":case"blank":e.attr("disabled","disabled").val("");break;case"equal":case"member":case"greater":case"less":case"hasExactly":case"hasGreater":case"hasLess":o(e,c)}return!0},o=function(e,t,n){"use strict";return s(e),n(),!0},c=function(e,t,n){"use strict";return $.get(e,function(e){t.html(e),n&&n()}),!0},u=function(e,t,n,r){"use strict";var s=i.get(e),a="doctypes/"+n+"/fieldsets/"+t+"/fields/"+e+"?format=json";return s?(r&&r(s),s):($.ajax({url:a,async:!1,dataType:"json",success:function(t){i.put(t),r&&r(i.get(e))}}),i.get(e))},l=function(){"use strict";var e={};e.setIndexDoctypeEvents=function(e,t,n){return e.change(function(){var i,r="doctypes/"+e.val()+"/fieldsets";n&&(i=n()),c(r,t,i)}),!1},e.setIndexFieldsetEvents=function(t,n,i,r){return n.change(function(){var e;if("string"!=typeof t&&(t=t.val()),n.val()){var s="doctypes/"+t+"/fieldsets/"+n.val()+"/fields?as=options";r&&(e=r()),c(s,i,e)}}),e},e.setIndexFieldEvents=function(t,n,i,r){return i.change(function(){var e,s=i.val(),a=n.val();r&&(e=r()),s.isBlank()||u(s,a,t,function(t){o(t,s,e)})}),e},e.setIndexOperatorEvents=function(t,n,i,r){return n.change(function(){var e;r&&(e=r()),a(t,n,i,e)}),e}};n.alterArg=a,n.alterOpts=o,n.fOpts=c,n.getFieldDoc=u,n.evs=l},{"../sess.js":47}],35:[function(e,t,n){var i=function(){"use strict";var e,t="indexes",n=$("#index-index-listing");return $.getJSON(t,function(t){e=templates["index-listing"].render(t),n.html(e)}),!0};n.init=i},{}],36:[function(e,t,n){var i=e("../pager.js").pager,r=function(){"use strict";return"preview"},s=function(){"use strict";var e=$("#index-editing-data").attr("data-index-id"),t="indexes/"+e+"/preview",n=$("#"+r()+"-list-view"),s=function(e){var t=JSON.parse(e);return t.rows=t.rows.map(function(e){return e.display_key=e.key.map(function(e){return e[1]}),e}),t};return e&&i({prefix:r(),format:s,url:t,target:n}).get(),!0};n.prefix=r,n.get=s},{"../pager.js":42}],37:[function(e,t,n){e("../jquery-ui-input-state.js"),e("./ihelpers.js");var i=e("./ilistingui.js"),r=e("../form.js"),s=e("./ievents.js"),a=function(){"use strict";var e=$("#index-doctype-input"),t=$("#index-fieldset-input").inputDisable(),n=$("#index-field-input").inputDisable(),a=$("#index-name-input"),o=$("#index-show_deleted-input"),c=function(){s.setIndexDoctypeEvents(e,t,function(){return t.inputDisable(),n.inputDisable(),function(){t.inputEnable()}})},u=function(){s.setIndexFieldsetEvents(e,t,n,function(){return n.inputDisable(),function(){n.inputEnable()}})},l=function(e){return $('#index-new-dialog option[value="'+e+'"]').text()},d=function(){return[l(t.val()),l(n.val())].join(":")},f=$("#index-new-dialog").dialog({autoOpen:!1,modal:!0,buttons:{Create:function(){$(".input").removeClass("ui-state-error");var t=!0;if(t){var s={category:"index",name:a.val(),show_deleted:o.is(":checked"),conditions:[],doctype:e.val(),fields_label:[d()],fields:[n.val()]},c=function(e){i.init(),$(e).dialog("close")};r.send("indexes",s,"POST",c,this)}},Cancel:function(){$(this).dialog("close")}},close:function(){t.unbind("change"),e.unbind("change"),r.clear($(".input")).removeClass("ui-state-error")}});return c(),u(),f};n.initIndexNewDialog=a},{"../form.js":29,"../jquery-ui-input-state.js":39,"./ievents.js":33,"./ihelpers.js":34,"./ilistingui.js":35}],38:[function(e,t,n){e("./ihelpers.js");var i=e("../form.js"),r=function(){"use strict";var e=$("#index-replace_function-input"),t=$("#index-editing-data"),n=$("#index-remove_function-input");t.attr("data-index-replace_function")?e.val(t.attr("data-index-replace_function")):i.clear(e).removeClass("ui-state-error");
var r=$("#index-replace-dialog").dialog({autoOpen:!1,modal:!0,buttons:{Save:function(){$(".input").removeClass("ui-state-error");var i=!0;n.is(":checked")?(t.removeAttr("data-index-replace_function"),$("#replace-function-message").empty()):(e.val().isBlank()?e.addClass("ui-state-error"):e.removeClass("ui-state-error"),i&&(t.attr("data-index-replace_function",e.val()),$("#replace-function-message").text("This index has a replacement function."))),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(){i.clear(e).removeClass("ui-state-error")}});return r};n.initReplaceDialog=r},{"../form.js":29,"./ihelpers.js":34}],39:[function(){(function(e){"use strict";e.fn.inputDisable=function(){return this.val(""),this.attr("disabled","disabled"),this.addClass("ui-state-disabled"),this},e.fn.inputEnable=function(){return this.removeAttr("disabled"),this.removeClass("ui-state-disabled"),this}})(jQuery)},{}],40:[function(){(function(e){"use strict";function t(t){if("string"==typeof t.data){var n=t.handler,i=t.data.toLowerCase().split(" ");t.handler=function(t){var r="keypress"!==t.type&&e.hotkeys.specialKeys[t.which],s=String.fromCharCode(t.which).toLowerCase(),a="",o={};t.altKey&&"alt"!==r&&(a+="alt+"),t.ctrlKey&&"ctrl"!==r&&(a+="ctrl+"),t.metaKey&&!t.ctrlKey&&"meta"!==r&&(a+="meta+"),t.shiftKey&&"shift"!==r&&(a+="shift+"),r?o[a+r]=!0:(o[a+s]=!0,o[a+e.hotkeys.shiftNums[s]]=!0,"shift+"===a&&(o[e.hotkeys.shiftNums[s]]=!0));for(var c=0,u=i.length;u>c;c++)if(o[i[c]])return n.apply(this,arguments)}}}e.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},e.each(["keydown","keyup","keypress"],function(){e.event.special[this]={add:t}})})(jQuery)},{}],41:[function(e,t,n){e("./jquery.hotkeys.js");var i=e("./sender.js"),r=e("./index_tool/ipreviewui.js"),s=e("./documents/indexui.js"),a=e("./documents/changeui.js"),o=e("./documents/editui.js"),c=e("./documents/viewui.js"),u=e("./documents/searchui.js"),l=function(){"use strict";return[r,s,a].forEach(function(e){var t=function(t){var n;window.clearTimeout(n),n=setTimeout(function(){8!==t.which&&46!==t.which&&e.get()},500)};document.addEventListener("keyup",function(n){n.target.id===e.prefix()+"-filter"?t(n):n.target.id===e.prefix()+"-limit"&&t(n)})}),$(document).on("keydown","#document-worksheets-form",function(e){return 13===e.which?(i.sender("worksheet-form-submit"),!1):!0}),$(document).on("keydown","#document-sets-form",function(e){return 13===e.which?(i.sender("sets-form-submit"),!1):!0}),$("#new-set-form").on("keydown",function(e){return 13===e.which?(i.sender("new-set-form-submit"),!1):!0}),$(document).bind("keydown","Alt+n",function(){var e=function(){return $("#edit-tabs")},t=e().find("li").length,n=e().tabs("option","active");return t-1>n?(e().tabs("option","active",n+1),i.sender("lost-focus")):(e().tabs("option","active",0),i.sender("lost-focus")),!1}),$(document).bind("keydown","Alt+c",function(){var e=$(document.activeElement).attr("id");return i.sender("initiated-command",e),!0}),$(document).bind("keydown","Alt+p",function(){var e=function(){return $("#edit-tabs")},t=e().find("li").length,n=e().tabs("option","active");return 0!==n?(e().tabs("option","active",n-1),i.sender("lost-focus")):(e().tabs("option","active",t-1),i.sender("lost-focus")),!1}),$(document).on("keydown","#edit-command-input",function(e){if(13===e.which){var t=$("#edit-command-input").val();i.sender("submitted-command",t)}return!0}),$(document).on("keydown","#edit-document-form input",function(e){return 13===e.which&&("none"===$("#save-document-button").css("display")?o.create():o.save()),!0}),$(document).on("keydown","#edit-document-form textarea","Alt+x",function(e){return o.toggleTextarea($(e.target)),!1}),$(document).on("keypress","#view-jump-id",function(e){if(13===e.which){var t=$("#view-jump-id").val();return c.get(t),!1}return!0}),$(document).on("keydown","#document-search-term",function(e){return 13===e.which?(u.getSearch(),!1):!0}),!0};n.keystrokes=l},{"./documents/changeui.js":17,"./documents/editui.js":20,"./documents/indexui.js":22,"./documents/searchui.js":23,"./documents/viewui.js":25,"./index_tool/ipreviewui.js":36,"./jquery.hotkeys.js":40,"./sender.js":46}],42:[function(e,t,n){var i=e("./form.js"),r=function(e){"use strict";var t={};void 0===e.prefix&&(e.prefix="index");var n=e.format,r=e.prefix,s=function(e){return window.btoa(window.unescape(window.encodeURIComponent(JSON.stringify(e))))},a=function(){return $("#"+r+"-limit")};return t.get=function(n,o,c,u){var l=e.url+"?",d=e.indexId,f=1*a().val(),p=e.target,h=$("#"+r+"-filter").val(),m={sk:n,sid:o,pks:c,pids:u};return m.pks||(m.sk=s(h),m.pks=[],m.pids=[]),m.sk&&(l=l+"startkey="+window.escape(window.atob(m.sk)),m.sid&&(l=l+"&startkey_docid="+m.sid)),f?l=l+"&limit="+(f+1):(a().val(25),l+="&limit=26"),d&&(l=l+"&index="+d),i.send(l,!1,"GET",function(e,n){t.fill(n,m,p)},this),t},t.fill=function(e,i,o){var c,u,l,d=1*a().val();return c=void 0===n?JSON.parse(e.responseText):n(e.responseText),l=c.rows.map(function(e){return e.encoded_key=s(e.key),e}),u=l.slice(-1),l[0]&&(l[0].firstrow=!0),l.length>d?c.rows=l.slice(0,-1):(c.rows=l,c.lastpage=!0),c.lastrow=u,c.prefix=r,o.html(templates["paged-listing"].render(c,{"listed-element":templates[r+"-element"]})),$("#previous-"+r+"-page").click(function(){t.get(i.pks.pop(),i.pids.pop(),i.pks,i.pids)}),$("#next-"+r+"-page").click(function(){var e=$("#next-"+r+"-page").attr("data-startkey"),n=$("#next-"+r+"-page").attr("data-startid"),s=$("#first-"+r+"-element").attr("data-first-key"),a=$("#first-"+r+"-element").attr("data-first-id");i.pks.push(s),i.pids.push(a),t.get(e,n,i.pks,i.pids)}),0===i.pks.length&&$("#previous-"+r+"-page").hide(),$("#next-"+r+"-page").attr("data-last-page")&&$("#next-"+r+"-page").hide(),t},t};n.pager=r},{"./form.js":29}],43:[function(e,t,n){var i=function(e){"use strict";var t;return t=$(e).attr("data-panel")?$("#"+$(e).attr("data-panel")):$(e).closest(".panel"),"none"===t.css("display")?t.css("display","table-cell"):t.css("display","none"),e};n.panelToggler=i},{}],44:[function(e,t,n){var i=e("./store.js").store,r=e("./form.js"),s=function(e,t,n){"use strict";var s,a={};s=t?t+"-":"",a.string=n?n+"/":"",a.category=t,a.origin=e,a.type=s+"path",a.valid_components=["doctype","fieldset","field"];var o=i(a.origin);return a.valid_components.forEach(function(e){a[e]=function(){var t=o.get(s+e);return t}()}),a.rev=o.get(s+"rev"),a.doctype=o.get(s+"doctype"),a.send=function(e,t,n,i){return r.send(""+a,e,t,n,i),a},a.put=function(e,t,n){return a.send(e,"PUT",t,n),a},a.post=function(e,t,n){return a.send(e,"POST",t,n),a},a.del=function(e,t){return a.send({},"DELETE",e,t),a},a.toString=function(){var e=a.string.concat(a.valid_components.map(function(e){var t=e+"s",n=a[e],i=null;return n?i=t+"/"+n:e===a.category&&(i=t),i}).filter(function(e){return"string"==typeof e&&!e.isBlank()}).join("/"));return a.rev&&(e=e.concat("?rev="+a.rev)),e},a};n.path=s},{"./form.js":29,"./store.js":49}],45:[function(e,t,n){var i,r=e("../form.js"),s=function(e){"use strict";window.confirm("Are you sure? This is permanent.")&&$.ajax({type:"DELETE",url:"/projects/"+e,dataType:"json",contentType:"application/json",complete:function(e){204===e.status?i():window.alert("An error occurred"+e.status)}})},a=function(){"use strict";var e=$("#project-name"),t=$("#project-description"),n=$(".validate-tips"),s=$([]).add(e).add(t),a=$("#add-dialog").dialog({autoOpen:!1,modal:!0,buttons:{"Add project":function(){s.removeClass("ui-state-error"),$(".validation-error-message").remove();var a=r.checkLength(e,"project name",1,50,n);a&&($.ajax({type:"POST",url:"projects/index",dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify({name:e.val(),description:t.val()}),complete:function(e){201===e.status?i():window.alert("An error occurred "+e.status)}}),$(this).dialog("close"))},Cancel:function(){$(this).dialog("close")}},close:function(){s.val("").removeClass("ui-state-error")}});return a},o=function(e){"use strict";var t=$(e).attr("id");return s(t),!0};i=function(){"use strict";var e="/projects/index";$.get(e,function(e){$("tbody").empty(),$("tbody").html(e)})},n.add=a,n.del=o,n.init=i},{"../form.js":29}],46:[function(e,t,n){var i=e("./documents/commands.js"),r=e("./documents/documents.js"),s=e("./documents/editui.js"),a=e("./documents/searchui.js"),o=e("./documents/setsui.js"),c=e("./documents/worksheetui.js"),u=function(e,t){"use strict";var n;switch(e){case"bad-session-state":n=r.clearSession();break;case"doctype-info-ready":n=r.makeLabels();break;case"labels-ready":n=a.loadSearchVals(),c.buildTemplate();break;case"new-set-form-submit":n=o.saveSelected();break;case"sets-changed":n=o.updateSelection();break;case"sets-form-submit":n=o.performOp();break;case"session-cleared":r.setVersion(),n=r.loadDoctype();break;case"worksheet-form-submit":n=c.fillWorksheet();break;case"initiated-command":n=i.dialogOpen(t);break;case"executed-command":n=i.dialogClose();break;case"submitted-command":n=i.execute(t);break;case"lost-focus":n=s.selectInput()}return n};n.sender=u},{"./documents/commands.js":18,"./documents/documents.js":19,"./documents/editui.js":20,"./documents/searchui.js":23,"./documents/setsui.js":24,"./documents/worksheetui.js":26}],47:[function(e,t,n){var i=function(e){"use strict";return window.sessionStorage[e._id]||(window.sessionStorage[e._id]=JSON.stringify(e)),e._id},r=function(e){"use strict";var t=window.sessionStorage[e];return t?JSON.parse(t):null};n.put=i,n.get=r},{}],48:[function(e,t,n){var i=function(e,t){"use strict";var n=e.some(function(e){return t===e});return n},r=function(e,t){"use strict";t||(t=i);var n=e.reduce(function(e,n){return t(e,n)?e:e.concat([n])},[]);return n},s=function(e,t,n){"use strict";n||(n=i);var s=r(e.concat(t),n);return s},a=function(e,t,n){"use strict";n||(n=i);var r=e.filter(function(e){return n(t,e)});return r},o=function(e,t,n){"use strict";n||(n=i);var r=e.filter(function(e){return!n(t,e)});return r},c=function(e,t,n){"use strict";n||(n=i);var r=o(e,t,n),a=o(t,e,n),c=s(r,a,n);return c};n.member=i,n.unique=r,n.union=s,n.intersection=a,n.relativeComplement=o,n.symmetricDifference=c},{}],49:[function(e,t,n){var i=e("./utils.js"),r=function(e){"use strict";return e};Function.prototype.r=function(){"use strict";return[this,arguments]},Function.prototype.t=function(){"use strict";for(var e=[this,arguments],t=arguments[arguments.length-1];e[0]!==t;)e=e[0].apply(this,e[1]);return t.apply(this,e[1])};var s=function(e){"use strict";var t={};return t.get=function(t){var n=e.attr("data-"+t);if(n)return n;var i=function(e,t,n){var r=t.attr("data-group-id"),s=$("#"+r),a=s.attr("data-"+e),o=s.attr("data-group-id");return void 0===a&&void 0!==o&&r!==o?i.r(e,s,n):n.r(a)};return i.t(t,e,r)},t.get64=function(e){var n=t.get(e);return n=i.Base64.decode(n.replace(/'/g,"")).replace(/(^'|'$)/g,"")},t.put=function(t,n){var i=e.attr("data-group-id");$("#"+i).attr("data-"+t,n)},t.fs=function(e){return t.get("fieldset-"+e)},t.f=function(e){return t.get("field-"+e)},t.d=function(e){return t.get("document-"+e)},t};n.store=s},{"./utils.js":50}],50:[function(e,t,n){var i=function(e){"use strict";return"string"!=typeof e||isNaN(e)||""===e?"":1*e},r=function(e){"use strict";return/^\s*$/.test(e)||null===e||void 0===e||"number"==typeof e&&isNaN(e)||"[object Array]"===Object.prototype.toString.call(e)&&0===e.length},s=function(e){"use strict";return!!e.match(/^[a-f0-9]{32}$/)},a={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){"use strict";var t,n,i,r,s,o,c,u="",l=0;for(e=a._utf8_encode(e);e.length>l;)t=e.charCodeAt(l++),n=e.charCodeAt(l++),i=e.charCodeAt(l++),r=t>>2,s=(3&t)<<4|n>>4,o=(15&n)<<2|i>>6,c=63&i,isNaN(n)?o=c=64:isNaN(i)&&(c=64),u=u+this._keyStr.charAt(r)+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(c);return u},decode:function(e){"use strict";var t,n,i,r,s,o,c,u="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");e.length>l;)r=this._keyStr.indexOf(e.charAt(l++)),s=this._keyStr.indexOf(e.charAt(l++)),o=this._keyStr.indexOf(e.charAt(l++)),c=this._keyStr.indexOf(e.charAt(l++)),t=r<<2|s>>4,n=(15&s)<<4|o>>2,i=(3&o)<<6|c,u+=String.fromCharCode(t),64!==o&&(u+=String.fromCharCode(n)),64!==c&&(u+=String.fromCharCode(i));return u=a._utf8_decode(u)},_utf8_encode:function(e){"use strict";e=e.replace(/\r\n/g,"\n");for(var t="",n=0;e.length>n;n++){var i=e.charCodeAt(n);128>i?t+=String.fromCharCode(i):i>127&&2048>i?(t+=String.fromCharCode(192|i>>6),t+=String.fromCharCode(128|63&i)):(t+=String.fromCharCode(224|i>>12),t+=String.fromCharCode(128|63&i>>6),t+=String.fromCharCode(128|63&i))}return t},_utf8_decode:function(e){"use strict";for(var t="",n=0,i=0,r=0,s=0;e.length>n;)i=e.charCodeAt(n),128>i?(t+=String.fromCharCode(i),n++):i>191&&224>i?(r=e.charCodeAt(n+1),t+=String.fromCharCode((31&i)<<6|63&r),n+=2):(r=e.charCodeAt(n+1),s=e.charCodeAt(n+2),t+=String.fromCharCode((15&i)<<12|(63&r)<<6|63&s),n+=3);return t}};n.stringToNumber=i,n.isBlank=r,n.validID=s,n.Base64=a},{}]},{},[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50]);